<!--
- Nome: Pasquale
    - Cognome: Pagano
    - Matricola: 0124003182
    - Corso di Laurea: Informatica
    - Anno Accademico: 2025/2026
            &
    - Nome: Daniele
    - Cognome: Mele
    - Matricola: 0124003006
    - Corso di Laurea: Informatica
    - Anno Accademico: 2025/2026
-->

<div class="section-content text-center z-10 mx-auto">

    <div class="header-strip flex items-center justify-start">
        <div class="flex items-center header-content">
            <img src="/static/img/logo.png" class="logo-contained">
            <span id="nome_azienda" class="ml-4 font-bold text-2xl"></span>
        </div>
    </div>

    <!-- PULSANTE AGGIUNGI CANTIERE -->
    <div
        class="bg-white/60 backdrop-blur-md border border-white/50 rounded-xl p-4 mb-6 shadow-sm flex flex-col md:flex-row items-center justify-between gap-4 shrink-0">

        <div class="text-left w-full md:w-auto">
            <h1 class="text-2xl font-bold text-gray-800 m-0 leading-tight">Gestione cantieri</h1>
            <p class="text-gray-500 text-sm m-0 font-medium">Cantieri salvati della tua azienda</p>
        </div>

        <div class="relative w-full md:w-auto">
                <button onclick="openAddCantiereModal()" class="add-btn">
                    Aggiungi Cantiere
                </button>
            </div>
    </div>

    <div class="table-card">
        <table class="admin-table">
            <thead>
                <tr class="text-left border-b border-gray-300/50">
                    <th class="pb-3">Luogo</th>
                    <th class="pb-3">Descrizione</th>
                    <th class="pb-3">QR</th>
                    <th class="pb-3">Stato</th>
                    <th class="pb-3 text-center">Azione</th>
                </tr>
            </thead>
            <tbody id="cantieri-table-body">
            </tbody>
        </table>
    </div>
</div>

<!--  MODALE CREAZIONE NUOVO CANTIERE -->
<div id="add-cantiere-modal" class="modal hidden">
    <div class="modal-content">
        <h3 class="text-xl font-bold mb-4">Nuovo Cantiere</h3>

        <small id="err_new_citta" class="text-red-500 text-sm hidden">La città è obbligatoria</small>
        <label class="block text-sm font-bold text-gray-700 mb-1">Città</label>
        <input id="new_citta" class="input-field mb-3" type="text" placeholder="Es. Napoli">

        <small id="err_new_via" class="text-red-500 text-sm hidden">La via è obbligatoria</small>
        <label class="block text-sm font-bold text-gray-700 mb-1">Via</label>
        <input id="new_via" class="input-field mb-3" type="text" placeholder="Es. Via Roma">

        <small id="err_new_civico" class="text-red-500 text-sm hidden">Il civico è obbligatorio</small>
        <label class="block text-sm font-bold text-gray-700 mb-1">Civico</label>
        <input id="new_civico" class="input-field mb-3" type="text" placeholder="Es. 42">

        <small id="err_new_CAP" class="text-red-500 text-sm hidden">Il CAP è obbligatorio</small>
        <label class="block text-sm font-bold text-gray-700 mb-1">CAP</label>
        <input id="new_CAP" class="input-field mb-3" type="text" placeholder="Es. 81030">

        <small id="err_new_descrizione" class="text-red-500 text-sm hidden">La descrizione è obbligatoria</small>
        <label class="block text-sm font-bold text-gray-700 mb-1">Descrizione Lavori</label>
        <textarea id="new_descrizione" class="input-field mb-3" rows="3"
            placeholder="Es. Ristrutturazione facciata e rifacimento balconi"></textarea>

        <div class="flex justify-end mt-4 gap-3">
            <button onclick="closeAddCantiereModal()" class="cancel-btn">Annulla</button>
            <button onclick="createCantiere()" class="confirm-btn">Crea</button>
        </div>
    </div>
</div>

<!-- MODALE MODIFICA CANTIERE -->
<div id="edit-cantiere-modal" class="modal hidden">
    <div class="modal-content">
        <h3 class="text-xl font-bold mb-4">Modifica Cantiere</h3>

        <input type="hidden" id="edit_qr_code">

        <small id="err_edit_citta" class="text-red-500 text-sm hidden">La città è obbligatoria</small>
        <label class="block text-sm font-bold text-gray-700 mb-1">Città</label>
        <input id="edit_citta" class="input-field mb-3" type="text">

        <small id="err_edit_via" class="text-red-500 text-sm hidden">La via è obbligatoria</small>
        <label class="block text-sm font-bold text-gray-700 mb-1">Via</label>
        <input id="edit_via" class="input-field mb-3" type="text">

        <small id="err_edit_civico" class="text-red-500 text-sm hidden">Il civico è obbligatorio</small>
        <label class="block text-sm font-bold text-gray-700 mb-1">Civico</label>
        <input id="edit_civico" class="input-field mb-3" type="text">

        <small id="err_edit_CAP" class="text-red-500 text-sm hidden">Il CAP è obbligatorio</small>
        <label class="block text-sm font-bold text-gray-700 mb-1">CAP</label>
        <input id="edit_CAP" class="input-field mb-3" type="text">

        <small id="err_edit_descrizione" class="text-red-500 text-sm hidden">La descrizione è obbligatoria</small>
        <label class="block text-sm font-bold text-gray-700 mb-1">Descrizione Lavori</label>
        <textarea id="edit_descrizione" class="input-field mb-3" rows="3"></textarea>

        <small id="err_edit_capo" class="text-red-500 text-sm hidden">Il capo è obbligatorio</small>
        <label class="block text-sm font-bold text-gray-700 mb-1">Scegli il capocantiere</label>
        <select id="edit_capo" class="input-field mb-3">
            <option value="">Scegli il capocantiere</option>
        </select>

        <small id="err_edit_stato" class="text-red-500 text-sm hidden">Lo stato è obbligatorio</small>
        <label class="block text-sm font-bold text-gray-700 mb-1">Stato Cantiere</label>
        <select id="edit_stato" class="input-field mb-3">
            <option value="DA">Da iniziare</option>
            <option value="IN">In corso</option>
            <option value="SO">Sospeso</option>
            <option value="FI">Finito</option>
        </select>

        <div class="flex justify-end mt-4 gap-3">
            <button onclick="closeEditCantiereModal()" class="cancel-btn">Annulla</button>
            <button onclick="updateCantiere()" class="confirm-btn">Salva</button>
        </div>
    </div>
</div>

<!-- Modale eliminazione cantiere -->
<div id="delete-cantiere-modal" class="modal hidden">
    <div class="modal-content">
        <h3 class="text-xl font-bold mb-4">Conferma Eliminazione</h3>

        <p id="delete-message" class="text-gray-700 mb-5">
            Sei sicuro di voler eliminare questo cantiere?
        </p>

        <div class="flex justify-end mt-4 gap-3">
            <button onclick="closeDeleteCantiereModal()" class="cancel-btn">Annulla</button>
            <button id="confirm-delete-cantiere-btn" class="delete-btn">Elimina</button>
        </div>
    </div>
</div>

<!-- MODALE SUCCESSO OPERAZIONE -->
<div id="success-modal" class="modal hidden">
    <div class="modal-content flex flex-col items-center text-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-green-600 mb-3 mx-auto" fill="none"
            viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
        </svg>

        <h3 class="text-xl font-bold mb-2">Operazione completata</h3>
        <p id="success-message" class="text-gray-700 mb-5">Cantiere salvato con successo</p>

        <button onclick="closeSuccessModal()" class="confirm-btn px-6">OK</button>
    </div>
</div>

<!-- MODALE QR CODE -->
<div id="qr-modal" class="modal hidden">
    <div class="modal-content flex flex-col items-center text-center">

        <h3 class="text-xl font-bold mb-4">Codice QR del Cantiere</h3>

        <img id="qr-modal-img" 
             src="" 
             alt="QR Code"
             class="mb-4 rounded border shadow-lg"
             style="width:200px;height:200px">

         <div class="flex gap-3">
            <button onclick="downloadQR()" class="confirm-btn px-6 bg-green-600">Scarica QR</button>
            <button onclick="closeQRModal()" class="confirm-btn px-6">Chiudi</button>
        </div>
    </div>
</div>